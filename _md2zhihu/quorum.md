
# å‰è¨€

<!--excerpt-->

paxoså¯ä»¥çœ‹åšæ˜¯2æ¬¡ [å¤šæ•°æ´¾è¯»å†™](https://zh.wikipedia.org/wiki/Quorum_(åˆ†å¸ƒå¼ç³»ç»Ÿ)) å®Œæˆä¸€æ¬¡å¼ºä¸€è‡´è¯»å†™.  å¤šæ•°æ´¾è¦æ±‚åŠæ•°ä»¥ä¸Šçš„å‚ä¸è€…(paxosä¸­çš„Acceptor)æ¥å—æŸç¬”æ“ä½œ.  ä½† [å¤šæ•°æ´¾è¯»å†™](https://zh.wikipedia.org/wiki/Quorum_(åˆ†å¸ƒå¼ç³»ç»Ÿ)) å¹¶ä¸ä¸€å®šéœ€è¦å¤šäºåŠæ•°çš„å‚ä¸è€…, åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æŸäº›åœºåˆçš„ä¼˜åŒ–, å¯ä»¥é€šè¿‡å‡å°‘å‚ä¸è€…æ•°é‡æ¥å®Œæˆçš„.
æœ¬æ–‡ä»‹ç»è¿™äº›ä¼˜åŒ–å¯¹ç³»ç»Ÿå¯ç”¨æ€§äº§ç”Ÿçš„å½±å“, æ ¹æ®ä»€ä¹ˆæ ‡å‡†æ¥é€‰æ‹©å’Œè°ƒæ•´è¿™äº›å‚æ•°.

![](https://cdn.jsdelivr.net/gh/drmingdrmer/drmingdrmer.github.io@_md2zhihu/asset/quorum/quorum-banner-small.jpg)

<!--more-->

# å¤šæ•°æ´¾è¯»å†™:åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºç¡€

åˆ†å¸ƒå¼ç³»ç»Ÿä¸­, å…¶ä¸­ä¸€ä¸ªåŸºç¡€çš„é—®é¢˜æ˜¯å¦‚ä½•åœ¨ä¸å¯é ç¡¬ä»¶(ä½å¯ç”¨æ€§)åŸºç¡€ä¸Šæ„å»ºå¯é (é«˜å¯ç”¨æ€§)çš„æœåŠ¡,
è¦è¾¾æˆè¿™ä¸ªç›®æ ‡, æ ¸å¿ƒçš„æ‰‹æ®µå°±æ˜¯å¤åˆ¶(ä¾‹å¦‚ä¸€ä»½æ•°æ®å­˜3ä¸ªå‰¯æœ¬).
è€Œå¤åˆ¶è¿‡ç¨‹ä¸­çš„ä¸€è‡´æ€§é—®é¢˜, æœ€åéƒ½å½’ç»“ä¸ºpaxosçš„è§£å†³æ–¹æ¡ˆ. è¿™äº›æˆ‘ä»¬åœ¨ [paxosçš„ç›´è§‚è§£é‡Š](https://blog.openacid.com/algo/paxos) ä¸­åšäº†è¯¦ç»†çš„ä»‹ç».

åœ¨ [paxosçš„ç›´è§‚è§£é‡Š](https://blog.openacid.com/algo/paxos) slide-20 ä¸­, æˆ‘ä»¬äº†è§£åˆ°, paxosæ˜¯é€šè¿‡2æ¬¡ [å¤šæ•°æ´¾è¯»å†™](https://zh.wikipedia.org/wiki/Quorum_(åˆ†å¸ƒå¼ç³»ç»Ÿ)) æ¥å®Œæˆå¼ºä¸€è‡´çš„è¯»å†™:

> è¿™ä¸ªæ–¹æ³•ä¹‹æ‰€ä»¥èƒ½å·¥ä½œä¹Ÿæ˜¯å› ä¸ºå¤šæ•°æ´¾å†™ä¸­, ä¸€ä¸ªç³»ç»Ÿæœ€å¤šåªèƒ½å…è®¸ä¸€ä¸ªå¤šæ•°æ´¾å†™æˆåŠŸ.
> paxosä¹Ÿæ˜¯é€šè¿‡2æ¬¡å¤šæ•°æ´¾è¯»å†™æ¥å®ç°çš„å¼ºä¸€è‡´.


ä¹Ÿå°±æ˜¯è¯´, [å¤šæ•°æ´¾è¯»å†™](https://zh.wikipedia.org/wiki/Quorum_(åˆ†å¸ƒå¼ç³»ç»Ÿ)) åœ¨åˆ†å¸ƒå¼é¢†åŸŸæ˜¯ä¸€ä¸ªæ›´åŸºç¡€çš„é—®é¢˜.
åœ¨ [paxosçš„ç›´è§‚è§£é‡Š](https://blog.openacid.com/algo/paxos) ä¸­ä¹Ÿç®€å•ä»‹ç»äº†ä¸€ä¸‹ [å¤šæ•°æ´¾è¯»å†™](https://zh.wikipedia.org/wiki/Quorum_(åˆ†å¸ƒå¼ç³»ç»Ÿ)):

> **slide-10**
> ä¸ºäº†è§£å†³åŠåŒæ­¥å¤åˆ¶ä¸­æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜, å¯ä»¥å°†è¿™ä¸ªå¤åˆ¶ç­–ç•¥å†åšä¸€æ”¹è¿›: **å¤šæ•°æ´¾è¯»å†™**: æ¯æ¡æ•°æ®å¿…é¡»å†™å…¥åˆ°**åŠæ•°ä»¥ä¸Š**çš„æœºå™¨ä¸Š. æ¯æ¬¡è¯»å–æ•°æ®éƒ½å¿…é¡»æ£€æŸ¥**åŠæ•°ä»¥ä¸Š**çš„æœºå™¨ä¸Šæ˜¯å¦æœ‰è¿™æ¡æ•°æ®.
> 
> åœ¨è¿™ç§ç­–ç•¥ä¸‹, æ•°æ®å¯é æ€§è¶³å¤Ÿ, å®•æœºå®¹å¿è¶³å¤Ÿ, ä»»ä¸€æœºå™¨æ•…éšœä¹Ÿèƒ½è¯»åˆ°å…¨éƒ¨æ•°æ®.


![img](https://cdn.jsdelivr.net/gh/drmingdrmer/drmingdrmer.github.io@_md2zhihu/asset/quorum/nwr.jpg)

[å¤šæ•°æ´¾è¯»å†™](https://zh.wikipedia.org/wiki/Quorum_(åˆ†å¸ƒå¼ç³»ç»Ÿ)), ä¹Ÿå¯ç§°ä½œ quorum-rw, wikipediaä¸Šçš„æè¿°å¦‚ä¸‹:

> åœ¨æœ‰å†—ä½™æ•°æ®çš„åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿå½“ä¸­ï¼Œå†—ä½™æ•°æ®å¯¹è±¡ä¼šåœ¨ä¸åŒçš„æœºå™¨ä¹‹é—´å­˜æ”¾å¤šä»½æ‹·è´ã€‚ä½†æ˜¯åŒä¸€æ—¶åˆ»ä¸€ä¸ªæ•°æ®å¯¹è±¡çš„å¤šä»½æ‹·è´åªèƒ½ç”¨äºè¯»æˆ–è€…ç”¨äºå†™ã€‚
> 
> ç®—æ³•æ¥æºäºGifford, 1979ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ¯ä¸€ä»½æ•°æ®æ‹·è´å¯¹è±¡éƒ½è¢«èµ‹äºˆä¸€ç¥¨ã€‚æ¯ä¸€ä¸ªè¯»æ“ä½œè·å¾—çš„ç¥¨æ•°å¿…é¡»å¤§äºæœ€å°è¯»ç¥¨æ•°ï¼ˆread quorumï¼‰ï¼ˆVrï¼‰ï¼Œæ¯ä¸ªå†™æ“ä½œè·å¾—çš„ç¥¨æ•°å¿…é¡»å¤§äºæœ€å°å†™ç¥¨æ•°ï¼ˆwrite quorumï¼‰(Vwï¼‰æ‰èƒ½è¯»æˆ–è€…å†™ã€‚å¦‚æœç³»ç»Ÿæœ‰Vç¥¨ï¼ˆæ„å‘³ç€ä¸€ä¸ªæ•°æ®å¯¹è±¡æœ‰Vä»½å†—ä½™æ‹·è´ï¼‰ï¼Œé‚£ä¹ˆæœ€å°è¯»å†™ç¥¨æ•°(quorum)åº”æ»¡è¶³å¦‚ä¸‹é™åˆ¶ï¼š
> 
> 1.  Vr + Vw > V
> 1.  Vw > V/2


ğŸŒ° ä¸¾ä¸ªä¾‹å­, å¦‚æœæœ‰5ä¸ªå­˜å‚¨èŠ‚ç‚¹`{a, b, c, d, e}`,
ä¸€ç¬”æ“ä½œç»™xèµ‹å€¼ä¸º3(x=3) æˆåŠŸå†™å…¥äº†abc 3ä¸ªèŠ‚ç‚¹, é‚£ä¹ˆå¦å¤–ä¸€ä¸ªè¯», åªè¦è”ç³»åˆ°ä»»æ„3ä¸ªèŠ‚ç‚¹,
å°±ä¸€å®šèƒ½è¯»åˆ°x=3
è¿™å°±æ˜¯å®‰å…¨çš„.

è¦è”ç³»åˆ°è‡³å°‘3ä¸ªèŠ‚ç‚¹, åœ¨æŸäº›åœºæ™¯ä¸‹ä»ç„¶æ˜¯æ˜‚è´µçš„, ä¾‹å¦‚ä¸€ä¸ªå…¨çƒåˆ†å¸ƒçš„DB,
2ä¸ªæœºæˆ¿ä¹‹é—´å»¶è¿Ÿå¯èƒ½è¾¾åˆ°ä¸Šç™¾æ¯«ç§’.
æˆ‘ä»¬æœ‰æ—¶å¸Œæœ›é€šè¿‡å‡å°‘å¿…é¡»å‚ä¸çš„èŠ‚ç‚¹æ•°é‡, ä»è€Œæå‡ç³»ç»Ÿçš„æ€§èƒ½.
äºæ˜¯æˆ‘ä»¬å…ˆä»æ¦‚å¿µå¼€å§‹, çœ‹çœ‹quorum-rwä¸­çš„quorumæ˜¯ä»€ä¹ˆ:

## Quorum vs Majority

åœ¨å¾ˆå¤špaperä¸­, æ˜¯ä¸åŒºåˆ†quorumå’Œmajorityçš„å·®åˆ«çš„:

-   majorityå°±æ˜¯"å¤šæ•°æ´¾"çš„æ„æ€(ä¹Ÿå°±æ˜¯**å¤šäºåŠæ•°**, `â‰¥âŒŠn/2âŒ‹+1`), ä¾‹å¦‚5èŠ‚ç‚¹ä¸­é€‰3ä¸ª;

-   quorum, ç¿»è¯‘ä¸º"æ³•å®šäººæ•°"( ğŸ¤” WT...?  ), å®ƒä¸ä¸€å®šæ˜¯å¤šæ•°, ä½†éœ€è¦æ»¡è¶³ä¸€ä¸ªæ¡ä»¶,
    å°±æ˜¯ä»»æ„2ä¸ªquorumå¿…é¡»æœ‰äº¤é›†(majorityå·²ç»æ»¡è¶³äº†è¿™ä¸ªè¦æ±‚).
    æ‰€ä»¥åœ¨æœ¬æ–‡ä¸­, **æˆ‘ä»¬å°†quorumçœ‹åšmajorityæ¦‚å¿µçš„ä¸€ä¸ªæ¨å¹¿; majorityæ˜¯quorumçš„ä¸€ä¸ªç‰¹ä¾‹**.

ä¸€èˆ¬æˆ‘ä»¬æåˆ°quorum(æˆ–majority)æ—¶, éƒ½æ˜¯æŒ‡ä¸€ä¸ªèŠ‚ç‚¹é›†åˆQ, æœ¬æ–‡ä¸­æˆ‘ä»¬æŠŠä¸€ä¸ªç³»ç»Ÿä¸­æ‰€æœ‰quorumçš„é›†åˆè®°ä¸ºâ„š:
`â„š = {Qâ‚, Qâ‚‚...}`,
å…¶ä¸­`Qâ‚“ = {aáµ¢, aâ±¼...}` æ˜¯ä¸€ä¸ªèŠ‚ç‚¹(paxosä¸­çš„Acceptor)çš„é›†åˆ, ä¾‹å¦‚ä¸€ä¸ªä¸‰èŠ‚ç‚¹ç³»ç»Ÿ`{a, b, c}`, å®ƒçš„majorityçš„quorumé›†åˆ `â„š = { {a, b}, {b, c}, {c, a}, {a, b, c} }`.

ç°åœ¨å†å›åˆ°é—®é¢˜, è¦ä¿è¯quorum-rwçš„æ­£ç¡®æ€§, å°±è¦æ±‚ä¸€æ¬¡æˆåŠŸçš„å†™å…¥, å¿…é¡»èƒ½æˆåŠŸè¯»å–,
ä»è¿™ç‚¹çœ‹, è¿‡åŠæ•°è¿™ä¸ªè¦æ±‚æ˜¯å¯ä»¥æ”¾å®½çš„:

åªéœ€è¦quorumä¿è¯**ä»»æ„2ä¸ªquorumæœ‰äº¤é›†**å°±å¯ä»¥.

> åœ¨[paxos made simple](http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple)ä¸­, ä¹Ÿå°±æ˜¯classic paxosçš„paperä¸­, [Leslie Lamport](http://www.lamport.org/) è¿˜åœ¨ä½¿ç”¨majorityè¿™ä¸ªåç§°æ¥è¡¨ç¤ºå¤šæ•°æ´¾, åœ¨åé¢çš„paper, fast-paxos, generalized paxosä¸­,éƒ½æ¢æˆäº†quorumè¿™ä¸ªåè¯.
> 
> è™½ç„¶åœ¨paperä¸­éƒ½æ˜¯"majority"çš„æ„æ€, ä½†quorumçš„é€‚ç”¨èŒƒå›´æ›´å¹¿.


æˆ‘ä»¬çœ‹å‡ ä¸ªémajorityçš„quorumçš„ä¾‹å­, è¿™äº›quoruméƒ½ä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„majority,
ä½†éƒ½å¯ä»¥å®ç°majorityåŒæ ·çš„åŠŸèƒ½, ä¸ºquorum-rwæˆ–paxosæä¾›æ­£ç¡®æ€§ä¿è¯:

# ä¸æ˜¯majorityçš„quorumä»¬

## å¸¦æƒé‡çš„quorum

`{a, b, c, d, e}` 5ä¸ªèŠ‚ç‚¹ä¸­, æŠŠa, b, cä¸‰ä¸ªèŠ‚ç‚¹éƒ¨ç½²åˆ°ä¸€èµ·: `{ abc, d, e}`(abcå¿…é¡»åŒæ—¶é€‰).
å¦‚æœé€‰abc, å°±è®°3ç¥¨, d, eåªè®°ä¸€ç¥¨.

3ä¸ªæˆå‘˜ä¸€å…±5ç¥¨, æ‰€æœ‰ç¥¨æ•°è¿‡åŠçš„é›†åˆéƒ½æ˜¯quorum: `{abc}`, `{abc, d}`, `{abc, e}`, `{abc, d, e}`.
ä½†`{d, e}` ä¸æ˜¯ä¸€ä¸ªquorum, å› ä¸ºæ ¹æ®æˆ‘ä»¬çš„å®šä¹‰, åªæœ‰2ç¥¨æ²¡æœ‰è¿‡åŠ.

è¿™æ ·, ä»»æ„2ä¸ªquoruméƒ½æœ‰äº¤é›†`{abc}`.
é‚£ä¹ˆquorum-rwç®—æ³•, å¦‚æœé€‰æ‹©ä»»æ„ä¸€ä¸ªquorumå†™, å¦ä¸€ä¸ªè¿›ç¨‹é€‰æ‹©ä»»æ„ä¸€ä¸ªquorumè¯»,
éƒ½å¯ä»¥å®ç°å®‰å…¨çš„è¯»å†™.

## åŒ…å«ç‰¹å®šå…ƒç´ çš„quorum

ä»ä¸Šé¢çš„ä¾‹å­, å¯ä»¥ç›´æ¥å»æ‰majorityçš„æ¦‚å¿µ, å°±æ˜¯ä¸€ç±»ç‰¹æ®Šçš„quorumé›†åˆ:
**â„š ä¸­æ¯ä¸ªquoruméƒ½å¿…é¡»åŒ…å«æŸä¸ªç‰¹å®šå…ƒç´ **:

å¦‚æœé›†ç¾¤æ˜¯3ä¸ªèŠ‚ç‚¹`{a,b,c}`, å®šä¹‰æ¯ä¸ªquoruméƒ½å¿…é¡»åŒ…å«a, é‚£ä¹ˆ:
`â„š = { {a}, {a,b}, {a,c}, {a,b,c} }`.

ä»»æ„2ä¸ªquoruméƒ½æœ‰äº¤é›†`{a}`, ç”¨è¿™ä¸ªquorumå®šä¹‰æ¥è¿è¡Œpaxos, ä»ç„¶æ˜¯æ­£ç¡®çš„. (å¯ä»¥è¯•è¯•è·‘ä¸€ä¸ªä¹‹å‰
[paxosçš„ç›´è§‚è§£é‡Š](https://blog.openacid.com/algo/paxos) ä¸­çš„ä¾‹å­é‡Œçš„paxos)

## 4/5 åŠ  2/5çš„quorum

åœ¨ä¸€ä¸ª5èŠ‚ç‚¹é›†ç¾¤`{a,b,c,d,e}` ä¸­, quorumå®šä¹‰ä¸º:è‡³å°‘åŒ…å«4ä¸ªå…ƒç´ , æˆ–æ˜¯`{a,b}`
é‚£ä¹ˆâ„š å°±æ˜¯:

```
{a, b, c, d}
{a, b, c, e}
{a, b, d, e}
{a, c, d, e}
{b, c, d, e}
{a, b}
```

ä»»ä¸€4ä¸ªå…ƒç´ çš„quoruméƒ½æœ‰äº¤é›†, ä»»ä¸€4å…ƒç´ çš„quorumä¹Ÿå’Œ`{a,b}`æœ‰äº¤é›†.
èƒ½ç”¨æ¥è·‘paxos.

## Hierarchical quorum 3x3

[hierarchical quorum](https://zookeeper.apache.org/doc/r3.3.2/zookeeperHierarchicalQuorums.html) æ˜¯ä¸€ä¸ªåˆ†å±‚çš„quorumå®šä¹‰,
å‡è®¾é›†ç¾¤æœ‰9ä¸ªèŠ‚ç‚¹, æ’åˆ—æˆ3x3çš„çŸ©é˜µ, è¿™é‡Œquorumçš„å®šä¹‰ä¸º: **è‡³å°‘åŒ…æ‹¬2è¡Œ, æ¯è¡Œä¸­è‡³å°‘åŒ…å«2ä¸ªèŠ‚ç‚¹**.

å®¹æ˜“çœ‹å‡ºä»»æ„2ä¸ªquorumå¿…æœ‰äº¤é›†, ä¾‹å¦‚ `{a1, a2, b1, b2}` å’Œ `{b2, b3, c2, c3}` æœ‰ä¸€ä¸ªäº¤é›†`{b2}`:

```
.------.
|a1  a2| a3
|   .--|---.
|b1 |b2| b3|
'------'   |
c1  |c2  c3|
    '------'
```

ä»¥æ­¤quorumå®šä¹‰æ›¿ä»£majority, è¿è¡Œå¤šæ•°æ´¾è¯»å†™æˆ–paxosä¸€æ ·æ˜¯æ­£ç¡®çš„.

## Hierarchical quorum 2xn

ç»§ç»­æ²¿ç”¨hierarchical quorum çš„å®šä¹‰, ä½†åªé€‰2è¡Œ.
å› ä¸ºä¸€ä¸ª2èŠ‚ç‚¹çš„ç³»ç»Ÿ`{x, y}`, quorumé›†åˆå¯ä»¥æ˜¯ `â„š = { {x}, {x, y} }`(æˆ– `â„š = { {x, y}, {y} }`),
(è¿™é‡Œx, yä»£è¡¨ä¸€è¡Œ).

äºæ˜¯è¿™ä¸ªåœºæ™¯ä¸­çš„quorum å¯ä»¥æè¿°ä¸º:
**åŒ…å«ç¬¬ä¸€è¡Œçš„majority, æˆ–åœ¨æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€ä¸ªmajority**:

```
a1 a2 a3
b1 b2 b3 b4 b5
```

å®¹æ˜“çœ‹å‡ºæŒ‰ç…§è¿™ä¸ªè§„åˆ™é€‰å‡ºçš„quorum, ä»»æ„2ä¸ªéƒ½æœ‰äº¤é›†.
ä¾‹å¦‚:

```
{a1, a3}
{
  a1, a2,
  b1, b2, b3,
}
```

æœ‰äº¤é›†`{a1}`.

[raft](https://raft.github.io/) ä½¿ç”¨äº†è¿™ç§quorumå®šä¹‰æ¥å®Œæˆé›†ç¾¤å˜æ›´, åŸºäºhierarchical
quorumçš„é€‰ä¸»åœ¨raftä¸­å«åš[joint consensus](https://github.com/peterbourgon/raft/blob/master/JOINT-CONSENSUS.md).

# é€šè¿‡è®¾è®¡ quorum é™ä½å»¶è¿Ÿ

ä»»ä½•ä¸€ç§quorumçš„å®šä¹‰, éƒ½å¯ä»¥ç”¨æ¥æ›¿ä»£majorityæ¥å®ç°quorum-rw, æˆ–paxos, å¹¶ä¸¥æ ¼ä¿è¯æ­£ç¡®æ€§.
ä½†æ˜¯, é€‰æ‹©ä¸€ç§quorum, å°†ç›´æ¥å½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç”¨æ€§.

é¦–å…ˆæœ€ç›´è§‚çš„ç»“è®ºæ˜¯, quorumå®šä¹‰ä¸­æ‰€éœ€çš„èŠ‚ç‚¹ä¸ªæ•°è¶Šå°‘,
å®Œæˆä¸€æ¬¡quorum-rwæˆ–paxosçš„æ¶ˆæ¯é‡å°±è¶Šå°‘, å¦‚æœå¯ä»¥é€‰æ‹©åˆ°æ›´è¿‘çš„èŠ‚ç‚¹,
é‚£ä¹ˆæ•´ä¸ªç³»ç»Ÿçš„å»¶è¿Ÿå°±æœ‰å¯èƒ½ä¼šé™ä½.

# quorum å†³å®šäº†ç³»ç»Ÿçš„å¯ç”¨æ€§

å¦ä¸€æ–¹é¢, ä¸åŒçš„quorumçš„é€‰æ‹©, ä¼šç›´æ¥å½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§:

**ä»»ä½•ä¸€ç§quorumçš„é€‰æ‹©, å¯ç”¨æ€§éƒ½ä½äºmajorityçš„quorum**.

émajorityçš„quorum,
å…è®¸æ›´å°‘çš„å¯ç”¨èŠ‚ç‚¹,
ä»¥3x3çš„hierarchical quorumå­˜å‚¨ä¸ºä¾‹,
ä¸€æ¬¡å†™å…¥å¦‚æœé€‰æ‹©äº†å·¦ä¸Šçš„4ä¸ªèŠ‚ç‚¹, å°±è¾¾åˆ°äº†quorumè¦æ±‚, åªéœ€è¦ä¸åˆ°åŠæ•°çš„èŠ‚ç‚¹å‚ä¸.
çœ‹ä¼¼å®¹å¿äº†æ›´å¤š(5ä¸ª)æ•…éšœ,
ä½†å®ƒæ•´ä½“çš„å¯ç”¨æ€§è¦ä½äºmajorityçš„quorum.

```
.-----.
|a1 a2| a3
|b1 b2| b3
'-----'
c1  c2  c3
```

## ç³»ç»Ÿå¯ç”¨æ€§çš„ quorum å®šä¹‰

ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯ç”¨æ€§, å¯ä»¥ä»ä¸€ä¸‹å‡ æ–¹é¢å»è€ƒè™‘, å‡è®¾:

-   é›†ç¾¤ä¸­çš„èŠ‚ç‚¹éšæœºåœæœº;
-   å¹¶å‡è®¾ä¸€æ®µæ—¶é—´å†…ä¸€ä¸ªæœåŠ¡å™¨åœæœºæ—¶é—´æ¯”ä¾‹p=0.01(å·®ä¸å¤šç›¸å½“äºä¸€ä¸ªæœåŠ¡å™¨ä¸€å¹´æœ‰3å¤©å·¦å³çš„æ—¶é—´ä¸åœ¨çº¿);
-   ä¸”åœæœºäº‹ä»¶å½¼æ­¤ç‹¬ç«‹.

æŸä¸ªæ—¶åˆ», **å¦‚æœåœ¨çº¿çš„èŠ‚ç‚¹é›†åˆæ˜¯ä¸€ä¸ªquorum,
é‚£ç³»ç»Ÿå°±å¯ç”¨, å¯ä»¥é€šè¿‡åœ¨çº¿èŠ‚ç‚¹é›†åˆè¿™ä¸ªquorumå®Œæˆå¤šæ•°æ´¾è¯»å†™æˆ–paxos; å¦åˆ™å°±æ˜¯ç³»ç»Ÿä¸å¯ç”¨**.

> ğŸŒ° ä¾‹å¦‚ `{a, b, c}` ä¸‰ä¸ªèŠ‚ç‚¹, é€‰æ‹©majorityçš„quorum,
> 
> -   a, b åœ¨çº¿, cåœæœºæ—¶, `{a, b}` æ˜¯ä¸€ä¸ªquorum æ‰€ä»¥ç³»ç»Ÿå¯ä»¥æ­£å¸¸è¿è¡Œ.
> -   å¦‚æœaåœ¨çº¿, b, céƒ½åœæœº, `{a}` ä¸æ˜¯ä¸€ä¸ªquorum, æ‰€ä»¥ç³»ç»Ÿè¿™æ—¶å°±ä¸å¯ç”¨äº†.


å› æ­¤æ•´ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§å¯ä»¥å®šä¹‰ä¸º: **æ¯ä¸ªquorumå‡ºç°çš„æ¦‚ç‡ä¹‹å’Œ: `P(â„š) = Î£P(Qáµ¢), for every Qáµ¢ âˆˆ â„š`.
quorumå‡ºç°çš„æ¦‚ç‡æ˜¯: P(Qáµ¢) = (1-p)Ë£pâ¿â»Ë£,
å…¶ä¸­xæ˜¯ä¸€ä¸ªquorumåŒ…å«çš„èŠ‚ç‚¹ä¸ªæ•°: x = |Qáµ¢|**.

> ğŸŒ° å¯¹ä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„ç³»ç»Ÿ `{a, b, c}`
> majority çš„quorumé›†åˆ`ğ•„ = { {a, b}, {b, c}, {c, a}, {a, b, c} }`,
> é‚£ä¹ˆ3ä¸ªèŠ‚ç‚¹å¯èƒ½å‡ºç°çš„æ‰€æœ‰çŠ¶æ€, ä»¥åŠå¯¹åº”çš„æ•´ä¸ªç³»ç»Ÿæ˜¯å¦å¯ç”¨å¦‚å°±å¦‚ä¸‹å±•ç¤º:
> 
> ```
> 0)  {}        (1-p)â°pÂ³    // unavailable
> 1)  {a}       (1-p)Â¹pÂ²    // unavailable
> 2)  {b}       (1-p)Â¹pÂ²    // unavailable
> 3)  {c}       (1-p)Â¹pÂ²    // unavailable
> 4)  {a, b}    (1-p)Â²pÂ¹    // available
> 5)  {b, c}    (1-p)Â²pÂ¹    // available
> 6)  {c, a}    (1-p)Â²pÂ¹    // available
> 7)  {a, b, c} (1-p)Â³pâ°    // available
> ```
> 
> å¦‚æœé€‰æ‹©majorityçš„quorumæ¥æ„å»ºç³»ç»Ÿ,
> é‚£ç³»ç»Ÿå¯ç”¨çš„æ¦‚ç‡æ˜¯å4è¡ŒçŠ¶æ€æ¦‚ç‡ç›¸åŠ :
> C(3, 2)(1-p)Â²pÂ¹ + C(3, 3)(1-p)Â³pâ° ~= 1-4pÂ² ~= 0.9996, å¤§çº¦3ä¸ª9
> 
> å¦‚æœé€‰æ‹©å¦ä¸€ç§quorum, ä¾‹å¦‚å»æ‰`{a, b}`, åŠ å…¥`{c}`, é‚£è¿™æ—¶å¯ç”¨æ€§æ˜¯ç¬¬3, 5, 6, 7è¡Œç›¸åŠ :
> (1-p)Â¹pÂ² + 2 (1-p)Â²pÂ¹ + (1-p)Â³pâ° = 1-p, å¤§çº¦2ä¸ª9,
> æ­¤æ—¶ç³»ç»Ÿä¸­æ¯ä¸ªquoruméƒ½åŒ…å«c, cåœ¨çº¿æˆ–åœæœºç›´æ¥å†³å®šäº†ç³»ç»Ÿçš„å¯ç”¨æ€§, æ‰€ä»¥ç³»ç»Ÿå¯ç”¨æ€§ä¹Ÿå°±æ˜¯ç›´æ¥ç­‰äºäº†cèŠ‚ç‚¹çš„å¯ç”¨æ€§.


## quorum çš„å¯ç”¨æ€§åˆ†æ

ç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆémajorityçš„quorum ä¼šé™ä½ç³»ç»Ÿçš„å¯ç”¨æ€§:

-   å‡è®¾majority quorumçš„é›†åˆä¸º`ğ•„`, ä¹Ÿå°±æ˜¯æ‰€æœ‰å¤§å°è¿‡åŠçš„èŠ‚ç‚¹é›†åˆ;
-   å¯¹æŸä¸€ä¸ªquorumé›†åˆ`â„š = {Qâ‚, Qâ‚‚...}`,
    å…¶ä¸­ `Qâ‚“ = {aáµ¢, aâ±¼...}` æ˜¯ä¸€ä¸ªèŠ‚ç‚¹é›†åˆ,
    Qâ‚“æ»¡è¶³å¯¹quorumçš„å®šä¹‰: ä»»æ„2ä¸ªQáµ¢, Qâ±¼äº¤é›†éƒ½ä¸ä¸ºç©º: `Qáµ¢ âˆ© Qâ±¼ â‰  Ã¸`;
-   å•æœºåœæœºå‡ ç‡ p = 0.01;

æˆ‘ä»¬å¯ä»¥å¯¹â„š åšä¸€ä¸ªå˜æ¢`f(â„š)`:

ä»â„š ä¸­é€‰æ‹©æœ€å°çš„ä¸€ä¸ªQáµ¢: Qáµ¢æ»¡è¶³`âˆ€Qâ±¼: |Qáµ¢| â‰¤ |Qâ±¼|` (å¦‚æœæœ‰å¤šä¸ªæœ€å°çš„, é€‰ä»»æ„ä¸€ä¸ª), ä»â„š ä¸­å»æ‰Qáµ¢, å†æŠŠQáµ¢çš„è¡¥é›†åŠ å…¥:

`â„š' = â„š \ {Qáµ¢} âˆª {~Qáµ¢}`

> **â„š'ä¹Ÿè¿˜æ˜¯ä¸€ä¸ªåˆæ³•quorumé›†åˆ**:
> å› ä¸ºå¯¹ä»»æ„ä¸€ä¸ªQâ±¼, å¦‚æœ`|Qâ±¼| â‰¥ |Qáµ¢|` ä¸”`Qâ±¼ â‰  Qáµ¢`, é‚£ä¹ˆQâ±¼ä¸€å®šåŒ…å«ä¸€ä¸ªä¸åœ¨Qáµ¢ä¸­çš„èŠ‚ç‚¹,
> æ‰€ä»¥ ~Qáµ¢ å’Œ Qâ±¼ä¸€å®šæœ‰äº¤é›†.


é‡å¤è¿™ä¸ªæ­¥éª¤ç›´åˆ°â„š ä¸­æ‰€æœ‰quorumçš„å¤§å°éƒ½å¤§äºåŠæ•°. æœ€åâ„š å°±å˜æˆäº†ä¸€ä¸ªğ•„ çš„å­é›†:
`f(â„š) âŠ† M`

è¿™æ ·, **ä»»ä½•ä¸€ä¸ªâ„š éƒ½å¯ä»¥è·Ÿ ğ•„ çš„ä¸€ä¸ªå­é›†å»ºç«‹ä¸€ä¸ªä¸€ä¸€æ˜ å°„.
è€Œğ•„ çš„å­é›†çš„å¯ç”¨æ€§ä¸€å®šä¸å¤§äºğ•„ çš„å¯ç”¨æ€§**: `P(subset(ğ•„)) â‰¤ P(ğ•„)`.

è€Œä¸”, **å¯¹ä¸€ä¸ªä¸å¤§äºåŠæ•°çš„Qáµ¢(`x = |Qáµ¢| â‰¤ âŒŠnâŒ‹/2`), å®ƒçš„è¡¥é›†åœ¨éšæœºåœæœºè¿‡ç¨‹ä¸­å‡ºç°çš„å‡ ç‡æ›´å¤§**:

`(1-p)Ë£pâ¿â»Ë£ â‰¤ (1-p)â¿â»Ë£pË£` â‡’ `P(Qáµ¢) â‰¤ P(~Qáµ¢)` â‡’ `P(â„š) â‰¤ P(f(Q))`.

âˆ´ `P(â„š) â‰¤ P(f(â„š)) â‰¤ P(ğ•„)`, å³ majority çš„ quorum å¯é æ€§æœ€é«˜. å…¶ä»–ä»»ä½•ä¸€ç§quorumçš„é€‰æ‹©, å³ä½¿å®ƒå…è®¸æ›´å¤šçš„èŠ‚ç‚¹åœæœº, ä¹Ÿåªèƒ½æä¾›è¾ƒä½çš„å¯ç”¨æ€§.

> ğŸŒ° ä¾‹å¦‚æˆ‘ä»¬ç®—ä¸‹, 3x3 çš„ hierarchical quoru mçš„å¯ç”¨æ€§:
> 
> -   majority 3 èŠ‚ç‚¹çš„åœæœºæ¦‚ç‡æ˜¯: `Pm3 = C(3, 2)(1-p)Â²p + C(3, 3)(1-p)Â³`
> -   Pm3ä¹Ÿå°±æ˜¯æ¯ä¸ªæœºæˆ¿çš„åœæœºæ¦‚ç‡, æŠŠæ¯ä¸ªæœºæˆ¿çœ‹åšä¸€ä¸ªå¤§çš„èŠ‚ç‚¹, å› æ­¤3ä¸ªæœºæˆ¿ç»„æˆçš„majority quorumçš„ä¸åœ¨çº¿å‡ ç‡æ˜¯: `Ph9 = C(3, 2)(1-Pm3)Â²Pm3 + C(3, 3)(1-Pm3)Â³`
> 
> æˆ‘ä»¬ç”¨ [hierarchical-quorum.py](/post-res/quorum/hierarchical-quorum.py) è¿™ä¸ªå°ç¨‹åºè®¡ç®—å¦‚ä¸‹:
> 
> ```
> failure-rate:
>   majority of 3 nodes:        2.98e-04
>   majority of 7 nodes:        3.42e-07
>   majority of 9 nodes:        1.22e-08
>   hierarchical quorum of 3x3: 2.66e-07
> ```
> 
> å¯ä»¥çœ‹åˆ°hierarchical 3x3 çš„å¯ç”¨æ€§æ¯”majority 9èŠ‚ç‚¹çš„å¯ç”¨æ€§è¦ä½1ä¸ª9.
> å·®ä¸å¤šç›¸å½“äº7èŠ‚ç‚¹çš„majority å¯ç”¨æ€§.


# åº”ç”¨åœºæ™¯

## zookeeper ä½¿ç”¨ hierarchical quorum çš„ä¾‹å­

ğŸŒ° [zookeeper](https://zookeeper.apache.org/) çš„é…ç½®å…è®¸åˆ†ç»„çš„æ¦‚å¿µ, å°±æ˜¯ä½¿ç”¨äº†è¿™ç§quorumå®šä¹‰, å®ƒå…è®¸å¤šäºåŠæ•°(5ä¸ª/9ä¸ª)èŠ‚ç‚¹åœæœº.
ä¾‹å¦‚åœ¨æˆ‘ä»¬ä¹‹å‰å®ç°çš„3æœºæˆ¿éƒ¨ç½²ä¸­, å°±ä½¿ç”¨äº†3ä¸ªæœºæˆ¿(DC),
æ¯ä¸ªæœºæˆ¿3ä¸ªzookeeperå®ä¾‹çš„é…ç½®:

```
            zookeeper
                |
    .-----------+----------.
   /            |           \
  DC-1         DC-2         DC-3
 / | \        / | \        / | \
a1 a2 a3     b1 b2 b3     c1 c2 c3
--------     --------     --------
   | `- 30ms -'    `- 30ms -' |
   `---------- 60ms ----------'
```

[hierarchical quorum](https://zookeeper.apache.org/doc/r3.3.2/zookeeperHierarchicalQuorums.html) çš„ä¸€ä¸ªä¼˜åŠ¿åœ¨äºåœ¨ç³»ç»Ÿå¯ç”¨çš„çŠ¶æ€ä¸‹,
**åªéœ€è¦è”ç³»2ä¸ªæœºæˆ¿å°±å¯ä»¥å®Œæˆä¸€æ¬¡è¯»å†™**.

æˆ‘ä»¬å‡è®¾ä¸€ä¸ªæ¥è¿‘ç°å®åœºæ™¯:

-   DC-1 å’Œ DC-2ä¹‹é—´çš„å»¶è¿Ÿæ˜¯30ms,
-   DC-2 å’Œ DC-3ä¹‹é—´ä¹Ÿæ˜¯30ms,
-   DC-1 å’Œ DC-3ä¹‹é—´æ¯”è¾ƒè¿œ, å»¶è¿Ÿæ˜¯60ms,

é‚£ä¹ˆé€‰æ‹© hierarchical quorum æ‰€äº§ç”Ÿçš„å»¶è¿Ÿå°±åœ¨ä¸€å®šæ¦‚ç‡ä¸Šæ¯”majority
quorumçš„å»¶è¿Ÿä½.

ä¾‹å¦‚, ç°åœ¨åªè§‚å¯ŸDC-1çš„å†™å…¥è¯·æ±‚, æœ€ä¼˜æƒ…å†µä¸‹å®ƒåªéœ€è”ç³»æœ€è¿‘çš„æœºæˆ¿(DC-2)æ¥å®Œæˆä¸€æ¬¡paxos.
å¦‚æœå®•æœº2ä¸ªèŠ‚ç‚¹:

-   hierarchical quorum éœ€è¦è”ç³»DC-3çš„æ¡ä»¶æ˜¯: è¿™2ä¸ªå®•æœºèŠ‚ç‚¹éƒ½é›†ä¸­åœ¨DC-1æˆ–éƒ½é›†ä¸­åœ¨DC-2æ—¶;
-   majority quorum     éœ€è¦è”ç³»DC-3çš„æ¡ä»¶æ˜¯: è¿™2ä¸ªå®•æœºèŠ‚ç‚¹éƒ½ä¸åœ¨DC-3æ—¶.

åœ¨å®•æœº2ä¸ªèŠ‚ç‚¹æ—¶, hierarchical åªæœ‰ majority 40% çš„å‡ ç‡å»¶è¿Ÿè¾¾åˆ° 60ms;
å¦‚æœå‡è®¾å•ä¸ªèŠ‚ç‚¹åœæœºå‡ ç‡æ˜¯p=0.01(1å¹´æœ‰3, 4å¤©ä¸åœ¨çº¿),
é‚£ä¹ˆ9èŠ‚ç‚¹å®•æœº2ä¸ªèŠ‚ç‚¹çš„å‡ ç‡å¤§çº¦æ˜¯0.0033,
å·®ä¸å¤šåœ¨99åˆ†ä½ä¸Š, å»¶è¿Ÿå¯ä»¥ä»60msé™ä½åˆ°30ms.

## ç”¨ quorum æ¥ä¼˜åŒ–é“¾è·¯é€‰æ‹©: è¾¹ç¼˜å­˜å‚¨åœºæ™¯

ğŸŒ° ä¼ ç»Ÿçš„å­˜å‚¨+CDNæ¶æ„æ˜¯ç”¨æˆ·ä¼ è¾“åˆ°ä¸­å¿ƒ, ä¹‹ååœ¨ä¸‹è½½æ—¶, å†é€šè¿‡è¾¹ç¼˜æœºæˆ¿è®¿é—®,
è¾¹ç¼˜æœºæˆ¿æ²¡æœ‰åˆ™å›ä¸­å¿ƒæ‹‰å–.
ä¸”è¾¹ç¼˜æœºæˆ¿ä¹‹é—´æ²¡æœ‰æ¶æ„çº§åˆ«çš„å…³è”, å„è‡ªåœ¨è®¾è®¡ä¸Šæ˜¯ç‹¬ç«‹çš„:

```
Center Storage + CDN:
            client
            |  â†‘
            |  |
  edge DCs  |  eâ‚   eâ‚‚   eâ‚ƒ
            |    â†–  â†‘  â†—
center DC   `-----â†’ c
```

å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªè¾¹ç¼˜å­˜å‚¨çš„ç³»ç»Ÿ: 3ä¸ªåˆ†å¸ƒåœ¨å„åœ°çš„è¾¹ç¼˜æœºæˆ¿eáµ¢, å’Œä¸€ä¸ªä¸­å¿ƒæœºæˆ¿c.

```
Edge Storage:
               client
               â†‘
               â†“
  edge DCs     eâ‚ - eâ‚‚ - eâ‚ƒ   // weight = 1
                 \  |  /
center DC           c         // weight = 2
```

-   è¾¹ç¼˜å­˜å‚¨çš„ç‰¹ç‚¹æ˜¯, ä¸€ä¸ªä¸­å¿ƒæœºæˆ¿c, ä¸€èˆ¬åŒ…å«å…¨é‡æ•°æ®, åšæ•°æ®çš„é›†ä¸­å¤„ç†, å½’æ¡£ç­‰.
    å†™å…¥ä¸€èˆ¬åˆ†æ•£åœ¨å„ä¸ªè¾¹ç¼˜æœºæˆ¿, æ–¹ä¾¿å°±è¿‘æ¥å…¥ç”¨æˆ·è¯·æ±‚.
    å¯ä»¥æŠŠè¾¹ç¼˜å­˜å‚¨æƒ³è±¡æˆæ”¯æŒæœ¬åœ°å°±è¿‘ä¸Šä¼ çš„CDN.

-   è¾¹ç¼˜è·Ÿä¸­å¿ƒçš„é“¾è·¯ä¸€èˆ¬å¾ˆå¥½. ä½†ä¹Ÿä¼šæœ‰æ•…éšœ, è¾¹ç¼˜è·Ÿè¾¹ç¼˜ä¹‹é—´é“¾è·¯è´¨é‡ä¸€èˆ¬.
    å› æ­¤åœ¨å¤„ç†ç”¨æˆ·å†™è¯·æ±‚æ—¶, å°½å¯èƒ½è®©è¾¹ç¼˜æœºæˆ¿eáµ¢ä¼˜å…ˆé€‰æ‹©è·Ÿä¸­å¿ƒæœºæˆ¿cåŒæ­¥, å½“è”ç³»ä¸åˆ°ä¸­å¿ƒæœºæˆ¿æ—¶, fallbackåˆ°å‡ ä¸ªè¾¹ç¼˜æœºæˆ¿ä¹‹é—´è¾¾æˆä¸€è‡´å®Œæˆä¸€ç¬”å†™å…¥.

    è¾¹ç¼˜å­˜å‚¨çš„æ¶æ„ç›¸æ¯”ä¼ ç»Ÿå­˜å‚¨+CDNçš„æ¨¡å¼, å¯ä»¥è®©å†™å…¥ç›´æ¥è½åœ¨è¾¹ç¼˜æœºæˆ¿, çœå»äº†ä¸€æ¬¡ä¸å¿…è¦çš„å¸¦å®½.

åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬è®¾ç½®ä¸­å¿ƒæœºæˆ¿cæƒé‡ä¸º2; 3ä¸ªè¾¹ç¼˜æœºæˆ¿, æƒé‡å„ä¸º1,
quorumå®šä¹‰æˆå¸¦æƒé‡çš„quorum: ä¸€ä¸ªquorumæ‰€åŒ…å«çš„èŠ‚ç‚¹æƒé‡ä¹‹å’Œè‡³å°‘ä¸º3.

å‡è®¾æœ‰1ç¬”å†™å…¥å‡ºç°åœ¨eâ‚, å¦‚æœå®ƒè·Ÿä¸­å¿ƒæœºæˆ¿cå¯ä»¥ç›´æ¥é€šä¿¡,
é‚£å°±é€šè¿‡quorum `{eâ‚, c}` ç›´æ¥å®Œæˆä¸€æ¬¡å¤šæ•°æ´¾å†™å…¥.
æˆ–è€…å½“æ—¶è·Ÿä¸­å¿ƒè¿æ¥æŠ–åŠ¨, é‚£ä¹ˆå®ƒä¹Ÿå¯ä»¥è”ç³»eâ‚‚, eâ‚ƒ, é€šè¿‡quorum `{eâ‚, eâ‚‚, eâ‚ƒ}`å®Œæˆä¸€æ¬¡å¤šæ•°æ´¾å†™å…¥.

# æ€»ç»“: quorum åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ„ä¹‰

å‡ å¹´å‰åœ¨ä¸€ä¸ªæœºæˆ¿é‡Œç”¨paxosååŒèµ·æ¥çš„åˆ†å¸ƒå¼ç³»ç»Ÿ, å¯ä»¥çœ‹åšæ˜¯åˆ†å¸ƒå¼çš„ä»0åˆ°1çš„ä¸€æ­¥, è§£å†³äº†**åˆ†å¸ƒ**é—®é¢˜.

åˆ†å¸ƒå¼ç³»ç»Ÿè¿‘å¹´çš„å‘å±•è¶Šæ¥è¶Šå€¾å‘äºå¼‚æ„, éå¯¹ç­‰, å¤§è§„æ¨¡çš„æ¶æ„å…±å­˜äºä¸€ä¸ªç³»ç»Ÿå†….
è¿™å°±å¯¹ä¸€è‡´æ€§ç®—æ³•æå‡ºäº†æ–°çš„è¦æ±‚, ç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½åœ¨å°è¯•è§£å†³ä»1åˆ°100çš„é—®é¢˜:
å°†å¯ç”¨çš„ç³»ç»Ÿæ‰“é€ æˆé€‚åº”å„ç§å¤æ‚åœºæ™¯çš„å¯é ç³»ç»Ÿ(è€Œä¸æ˜¯ç®€å•çš„å•æœºæˆ¿å‡ ä¸ªæœåŠ¡å™¨çš„å•ä¸€åœºæ™¯):
ç³»ç»Ÿåœ¨èŠ‚ç‚¹å»¶è¿Ÿ/æ•…éšœç‡/æ€§èƒ½ç­‰å˜å¾—è¶Šæ¥è¶Šå¤æ‚çš„æƒ…å†µä¸‹,
ç³»ç»Ÿè®¾è®¡çš„é‡å¿ƒä»æ­£ç¡®æ€§è½¬ç§»åˆ°è°ƒä¼˜æ–¹é¢,
ä¾‹å¦‚å¦‚ä½•è®©è¯»å†™å€¾å‘äºé›†ä¸­åœ¨é«˜æ€§èƒ½æˆ–æ›´ç¨³å®šçš„èŠ‚ç‚¹ä¸Š, æˆ–è€…è®©è¯»å†™çš„æµé‡ä¼˜å…ˆæœ€è¿‘çš„.

é€šè¿‡é€‰æ‹©åˆé€‚çš„quorum, æˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›**å¤æ‚ä¸€äº›**çš„ç³»ç»Ÿä¸­, å…è®¸ä¸šåŠ¡åœ¨å¯ç”¨æ€§, å»¶è¿Ÿ, æ€§èƒ½ä¹‹é—´åšä¸€ä¸ªæƒè¡¡:

-   å‡å°‘æ¶ˆæ¯æ•°é‡/å»¶è¿Ÿ, ä¾‹å¦‚åƒ**zookeeper** hierarchical quorumä¸­çš„å¼‚åœ°å¤šæ´»çš„ä¾‹å­, å¯ç”¨æ€§ä»8ä¸ª9é™ä½åˆ°7ä¸ª9(å‡è®¾7ä¸ª9å¤Ÿç”¨äº†:D), æ¢æ¥æ›´ç¨³å®šçš„å†™å…¥å»¶è¿Ÿ: P99 å»¶è¿Ÿå¯ä»¥ä»60msé™ä½åˆ°30ms.

-   ä½¿ç”¨åŠ æƒé‡çš„quorum, æ¥å®ç°**è¾¹ç¼˜å­˜å‚¨**è¿™ç§éå¯¹ç­‰ç³»ç»Ÿä¸­çš„é“¾è·¯é€‰æ‹©å’Œfallbackæœºåˆ¶.

-   æˆ–å®ç°æ›´çµæ´»çš„é…ç½®å˜åŒ–, ä¾‹å¦‚[raft](https://raft.github.io/) çš„æˆå‘˜å˜æ›´ç®—æ³•.

{% include build_ref %}



Reference:

- raft : [https://raft.github.io/](https://raft.github.io/)

- joint consensus : [https://github.com/peterbourgon/raft/blob/master/JOINT-CONSENSUS.md](https://github.com/peterbourgon/raft/blob/master/JOINT-CONSENSUS.md)

- Classic Paxos : [http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple](http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple)

- Fast Paxos : [http://lamport.azurewebsites.net/pubs/pubs.html#fast-paxos](http://lamport.azurewebsites.net/pubs/pubs.html#fast-paxos)

- paxosçš„ç›´è§‚è§£é‡Š : [https://blog.openacid.com/algo/paxos](https://blog.openacid.com/algo/paxos)

- Leslie Lamport : [http://www.lamport.org/](http://www.lamport.org/)

- å¤šæ•°æ´¾è¯»å†™ : [https://zh.wikipedia.org/wiki/Quorum_(åˆ†å¸ƒå¼ç³»ç»Ÿ)](https://zh.wikipedia.org/wiki/Quorum_(åˆ†å¸ƒå¼ç³»ç»Ÿ))

- paxos made simple : [http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple](http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple)

- hierarchical quorum : [https://zookeeper.apache.org/doc/r3.3.2/zookeeperHierarchicalQuorums.html](https://zookeeper.apache.org/doc/r3.3.2/zookeeperHierarchicalQuorums.html)

- hierarchical-quorum.py : [/post-res/quorum/hierarchical-quorum.py](/post-res/quorum/hierarchical-quorum.py)

- zookeeper : [https://zookeeper.apache.org/](https://zookeeper.apache.org/)


[raft]: https://raft.github.io/  "raft"
[joint consensus]: https://github.com/peterbourgon/raft/blob/master/JOINT-CONSENSUS.md "joint consensus"
[Classic Paxos]: http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple  "Classic Paxos"
[Fast Paxos]: http://lamport.azurewebsites.net/pubs/pubs.html#fast-paxos   "Fast Paxos"
[paxosçš„ç›´è§‚è§£é‡Š]: https://blog.openacid.com/algo/paxos                               "å¯é åˆ†å¸ƒå¼ç³»ç»Ÿ-paxosçš„ç›´è§‚è§£é‡Š"
[Leslie Lamport]: http://www.lamport.org/ "Leslie Lamport"
[å¤šæ•°æ´¾è¯»å†™]: https://zh.wikipedia.org/wiki/Quorum_(åˆ†å¸ƒå¼ç³»ç»Ÿ) "å¤šæ•°æ´¾è¯»å†™"
[paxos made simple]: http://lamport.azurewebsites.net/pubs/pubs.html#paxos-simple "paxos made simple"
[hierarchical quorum]: https://zookeeper.apache.org/doc/r3.3.2/zookeeperHierarchicalQuorums.html "hierarchical quorum"
[hierarchical-quorum.py]: /post-res/quorum/hierarchical-quorum.py "hierarchical-quorum.py"
[zookeeper]: https://zookeeper.apache.org/ "zookeeper"